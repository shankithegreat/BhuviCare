define(["durandal/system", "durandal/composition", "jquery"], function (i, t, e) { function n(i, t) { i.classList.remove(t ? "entrance-in-fade" : "entrance-in"), i.classList.remove("entrance-out") } var a = 100, o = { left: "0px", opacity: 1 }, s = { left: "", top: "", right: "", bottom: "", position: "", opacity: "" }, c = navigator.userAgent.match(/Trident/) || navigator.userAgent.match(/MSIE/), r = !1, l = "Webkit Moz O ms Khtml".split(" "), d = document.createElement("div"); if (void 0 !== d.style.animationName && (r = !0), !r) for (var u = 0; u < l.length; u++) if (void 0 !== d.style[l[u] + "AnimationName"]) { r = !0; break } r ? c ? i.log("Using CSS3/jQuery mixed animations.") : i.log("Using CSS3 animations.") : i.log("Using jQuery animations."); var m = function (t) { return i.defer(function (i) { function l() { i.resolve() } function d() { t.keepScrollPosition || e(document).scrollTop(0) } function u() { d(), t.triggerAttach(), r ? (n(t.child, v), t.child.classList.add(v ? "entrance-in-fade" : "entrance-in"), setTimeout(function () { n(t.child, v), t.activeView && n(t.activeView, v), f.css(s), l() }, m)) : f.animate(o, { duration: m, easing: "swing", always: function () { f.css(s), l() } }) } if (t.child) { var m = t.duration || 500, f = e(t.child), v = !!t.fadeOnly, g = { display: "block", opacity: 0, position: "absolute", left: v || r ? "0px" : "20px", right: 0, top: 0, bottom: 0 }; f.css(g), t.activeView ? r && !c ? (n(t.activeView, v), t.activeView.classList.add("entrance-out"), setTimeout(u, a)) : e(t.activeView).fadeOut({ duration: a, always: u }) : u() } else e(t.activeView).fadeOut(a, l) }).promise() }; return m });